<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
  <c:set var="title" value="Battle Data"/>
  <ui:composition template="/WEB-INF/templates/admin-template.xhtml">
    <ui:define name="navigation">
      <ul>
        <li>Campaign | <h:link outcome="/admin/combat/data" value="Battle"/>
          <ul>
            <li><h:link outcome="/admin/campaign/characters" value="Characters"/></li>
            <li>Powers</li>
            <li>Equipment</li>
            <li>Data</li>
          </ul>
        </li>
      </ul>
    </ui:define>
    <ui:define name="resources">
      <script>
        $(function () {
          var newBonus = {};

          $(".characterDetail").dialog({autoOpen: false, width: "80%"});
          $("#addNewFeatureDialog").dialog({autoOpen: false});
          $(".nameLink").on("click", function () {
            var charId = $(this).html();
            $("#" + charId).dialog("open");
            $("#" + charId).find(".addNewFeatureButton").button().on("click", function () {
              $("#addNewFeatureDialog").dialog("option", "title", "Add feature to: " + charId);
              $("#addNewFeatureDialog").dialog("open");
              $(".addNewFeatureCharacter").val(charId);
              newBonus = {};
              buildBonus();
            });
          });

          $(".addNewFeatureCharacter").hide();
          $(".addNewFeatureBonus").hide();

          $("#addNewFeatureAddButton").button().on("click", function () {
            var feature = $("#addNewFeatureSelectFeat").val();
            var bonus = $("#addNewFeatureValueFeat").val();
            newBonus[feature] = bonus;
            buildBonus();
          });

          function buildBonus() {
            var bonusArea = $("#bonusContent");
            bonusArea.html("");
            for (var property in newBonus) {
              var button = $("<input/>");
              button.attr("value", property + " " + newBonus[property]);
              button.button().on("click", function () {
                delete newBonus[property];
                buildBonus();
              });
              bonusArea.append(button);
            }
            $(".addNewFeatureBonus").val(JSON.stringify(newBonus));
          }

        });
      </script>
      <script>
        $(function () {
          $(".tooltip").each(function () {
            var tooltipDiv = $(this);
            //tooltipDiv.parent().tooltip();
            tooltipDiv.parent().tooltip({content: function () {
                return tooltipDiv.html();
              }});
            tooltipDiv.hide();
          });
        });
      </script>
    </ui:define>
    <ui:define name="content">
      <h:form>
        <h1>Ability Scores</h1>
        <h2>Characters</h2>
        <h:commandButton action="${adminCampaign.saveAll}" value="Save All"/>
        <h:dataTable value="${adminCampaign.characters}" var="cha">
          <h:column>
            <f:facet name="header">Name</f:facet><a class="nameLink" href="#">${cha.name}</a>
          </h:column>
          <h:column>
            <f:facet name="header">Class</f:facet>${cha.charClass.name}
          </h:column>
          <h:column>
            <f:facet name="header">Type</f:facet>
            <h:selectOneMenu value="${cha.ctype}">
              <f:selectItems value="${adminCampaign.types}"></f:selectItems>
            </h:selectOneMenu>
          </h:column>
          <h:column>
            <f:facet name="header">LVL</f:facet><h:inputText value="${cha.lvl}" size="2"/>
          </h:column>
          <h:column>
            <f:facet name="header">STR</f:facet><h:inputText value="${cha.strength}" size="2"/>
          </h:column>
          <h:column>
            <f:facet name="header">CON</f:facet><h:inputText value="${cha.constitution}" size="2"/>
          </h:column>
          <h:column>
            <f:facet name="header">DEX</f:facet><h:inputText value="${cha.dexterity}" size="2"/>
          </h:column>
          <h:column>
            <f:facet name="header">INT</f:facet><h:inputText value="${cha.intelligence}" size="2"/>
          </h:column>
          <h:column>
            <f:facet name="header">WIS</f:facet><h:inputText value="${cha.wisdom}" size="2"/>
          </h:column>
          <h:column>
            <f:facet name="header">CHA</f:facet><h:inputText value="${cha.charisma}" size="2"/>
          </h:column>
        </h:dataTable>
        <h:commandButton action="${adminCampaign.saveAll}" value="Save All"/>
      </h:form>

      <br style="clear: both;"/>

      <c:forEach items="${adminCampaign.characters}" var="cha">
        <div id="${cha.name}" class="characterDetail" title="${cha.name}">
          <h:form>
            <table>
              <thead>
                <tr>
                  <th>Scores</th>
                  <th>Skills</th>
                  <th>Features</th>
                </tr>
              </thead>
              <tr style="font-size: .8em;">
                <td style="vertical-align: top;">

                  <table>
                    <tr><td>LVL</td><td><h:inputText value="${cha.lvl}" size="2"/></td></tr>
                    <tr><td></td><td></td></tr>
                    <tr><td>Type</td><td><h:selectOneMenu value="${cha.ctype}">
                          <f:selectItems value="${adminCampaign.types}"></f:selectItems>
                        </h:selectOneMenu></td></tr>
                    <tr><td></td><td></td></tr>
                    <tr><td>STR</td><td><h:inputText value="${cha.strength}" size="2"/></td></tr>
                    <tr><td>CON</td><td><h:inputText value="${cha.constitution}" size="2"/></td></tr>
                    <tr><td>DEX</td><td><h:inputText value="${cha.dexterity}" size="2"/></td></tr>
                    <tr><td>INT</td><td><h:inputText value="${cha.intelligence}" size="2"/></td></tr>
                    <tr><td>WIS</td><td><h:inputText value="${cha.wisdom}" size="2"/></td></tr>
                    <tr><td>CHA</td><td><h:inputText value="${cha.charisma}" size="2"/></td></tr>
                  </table>

                  <h:commandButton value="SAVE" action="${adminCampaign.save(cha)}"/>
                </td>
                <td style="vertical-align: top;">

                  <h:dataTable value="${cha.skills}" var="skill">
                    <h:column><f:facet name="header">Name</f:facet>${skill.id.skill}</h:column>
                    <h:column><f:facet name="header">Ability</f:facet>${skill.ability}</h:column>
                    <h:column><f:facet name="header">Bonus</f:facet><h:inputText value="${skill.bonus}" size="2"/></h:column>
                  </h:dataTable>

                </td>
                <td style="vertical-align: top;">

                  <c:forEach items="${cha.bonuses}" var="feature">
                    <span title="">${feature.name}<div class="tooltip">
                        <h4>${feature.name}</h4>
                        ${feature.description}
                        <table>
                          <c:forEach items="${adminCampaign.displayBonus(feature)}" var="bonus">
                            <tr><td>${bonus.stat}</td><td>${bonus.value}</td></tr>
                          </c:forEach>
                        </table>
                      </div></span>
                    <h:commandButton value="X" action="${adminCampaign.removeFeat(cha, feature)}"/>
                    <br/>
                  </c:forEach>
                  <input type="button" value="ADD NEW" class="addNewFeatureButton"/>  

                </td>
              </tr>
            </table>
          </h:form>
        </div>
      </c:forEach>
      <div id="addNewFeatureDialog">
        <h:form>
          <h:inputText value="${adminCampaign.newfeature.name}" size="20"/><br/>
          <h:inputTextarea value="${adminCampaign.newfeature.description}" rows="3" cols="20"/><br/>
          <select>
            <option value="">Select one</option>
            <option value="">Ability Score</option>
            <option value="">Attacks</option>
            <option value="">Hit Points</option>
            <option value="">Defenses</option>
            <option value="">Other Attributes</option>
            <option value="">Skills</option>
          </select>
          <select id="addNewFeatureSelectFeat">
            <option value="STR">Strength</option>
            <option value="CON">Constitution</option>
            <option value="DEX">Dexterity</option>
            <option value="INT">Intelligence</option>
            <option value="WIS">Wisdom</option>
            <option value="CHA">Charisma</option>
          </select>
          <input type="text" size="2" id="addNewFeatureValueFeat"/>
          <input type="button" value="+" id="addNewFeatureAddButton" />
          <div id="bonusContent"></div>
          <h:commandButton value="ADD NEW" action="${adminCampaign.addFeature()}"/>
          <h:inputText value="${adminCampaign.newfeature.bonus}" class="addNewFeatureBonus"/>
          <h:inputText value="${adminCampaign.newfeature.chara}" class="addNewFeatureCharacter"/>
        </h:form>
      </div>
    </ui:define>
  </ui:composition>
</html>

